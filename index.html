<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ€„ é›€ç¥é›²ç«¯è¨˜å¸³</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #1e6f50; /* éº»å°‡æ¡Œç¶  */
            --card-bg: #ffffff;
            --primary-color: #f1c40f; /* é‡‘è‰² */
            --win-color: #e74c3c; /* ç´…è‰²è´ */
            --lose-color: #27ae60; /* ç¶ è‰²è¼¸ */
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            margin: 0; 
            padding: 20px 10px 80px 10px; /* åº•éƒ¨ç•™ç™½çµ¦æŒ‰éˆ• */
            max-width: 600px; 
            margin-left: auto; 
            margin-right: auto;
        }

        h1 { 
            text-align: center; 
            color: #fff; 
            margin-bottom: 5px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* ç‹€æ…‹åˆ— */
        #status { 
            text-align: center; 
            font-size: 13px; 
            color: rgba(255,255,255,0.8); 
            margin-bottom: 20px; 
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
        }
        .online-dot { height: 8px; width: 8px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .connected { background-color: #2ecc71; box-shadow: 0 0 5px #2ecc71; }

        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: 16px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
            margin-bottom: 20px; 
            transition: transform 0.2s, border-color 0.3s;
            border: 2px solid transparent;
        }

        /* æ¨™é¡Œæ¨£å¼ */
        .card h3 {
            margin-top: 0;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            color: var(--bg-color);
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ç·¨è¼¯æ¨¡å¼é«˜äº® */
        .editing-mode { border-color: #f39c12; transform: scale(1.02); }

        /* è¼¸å…¥å€ä½ˆå±€ */
        .top-inputs { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .input-group label { display: block; font-size: 12px; color: var(--text-light); margin-bottom: 4px; font-weight: bold; }
        .input-style { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 16px; box-sizing: border-box; background: #f9f9f9; text-align: center;
        }

        /* ç©å®¶è¼¸å…¥è¡Œ */
        .player-row { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; }
        .name-select, .custom-name { 
            flex: 2; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 16px; background: white; -webkit-appearance: none;
        }
        .score-input { 
            flex: 1.5; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 18px; text-align: center; font-weight: bold; color: var(--text-main);
        }

        /* æ­£è² æŒ‰éˆ•å„ªåŒ– */
        .sign-btn { 
            flex: 0 0 45px; height: 45px; font-size: 24px; font-weight: bold; 
            border: none; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.2s;
        }
        .btn-plus { background-color: #fff; color: var(--win-color); border: 2px solid var(--win-color); }
        .btn-minus { background-color: var(--lose-color); color: white; border: 2px solid var(--lose-color); }
        .btn-plus:active, .btn-minus:active { transform: scale(0.9); }

        /* å„²å­˜æŒ‰éˆ• */
        .action-btn { 
            width: 100%; padding: 15px; background-color: var(--text-main); color: white; 
            border: none; border-radius: 12px; font-size: 18px; font-weight: bold; 
            cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }
        .action-btn:active { transform: scale(0.98); }
        .cancel-btn { 
            width: 100%; padding: 12px; background-color: #95a5a6; color: white; 
            border: none; border-radius: 12px; font-size: 16px; cursor: pointer; 
            margin-top: 8px; display: none; 
        }

        /* è¡¨æ ¼å„ªåŒ– */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 14px; }
        th { background-color: #f8f9fa; color: #888; font-weight: 600; padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #eee; }
        
        .win-text { color: var(--win-color); font-weight: bold; }
        .lose-text { color: var(--lose-color); font-weight: bold; }
        .zero-text { color: #ccc; }
        
        /* æ’åæ¨£å¼ */
        .rank-badge { display: inline-block; width: 24px; height: 24px; line-height: 24px; border-radius: 50%; background: #eee; font-size: 12px; }
        .rank-1 { background: #f1c40f; color: white; box-shadow: 0 2px 5px rgba(241, 196, 15, 0.4); }
        .rank-2 { background: #95a5a6; color: white; }
        .rank-3 { background: #d35400; color: white; }

        /* æ­·å²ç´€éŒ„å¡ç‰‡å„ªåŒ– */
        .history-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 0; border-bottom: 1px solid #eee; 
        }
        .history-date { font-size: 12px; color: #999; margin-bottom: 4px; }
        .history-info { display: flex; gap: 10px; font-size: 12px; color: #555; background: #f0f0f0; padding: 2px 8px; border-radius: 4px; display: inline-block;}
        .history-scores { display: grid; grid-template-columns: 1fr 1fr; gap: 5px 15px; margin-top: 8px; font-size: 14px; }
        .history-actions button { margin-left: 5px; }

        .edit-btn { background: #f39c12; color: white; border: none; padding: 5px 10px; border-radius: 6px; }
        .delete-btn { background: #ff7675; color: white; border: none; padding: 5px 10px; border-radius: 6px; }

        /* çµ±è¨ˆå€å¡Š */
        .stat-box { background: #eafcf4; border-radius: 8px; padding: 10px; margin-top: 5px; border: 1px solid #c8e6c9; }
        .yearly-total { text-align: center; font-weight: bold; color: var(--bg-color); font-size: 16px; margin-top: 10px; padding-top: 10px; border-top: 2px dashed #ccc; }

        /* éŒ¯èª¤è¨Šæ¯ */
        .error-msg { background: #ffebee; color: #c62828; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ€„ é›€ç¥è¨˜å¸³æœ¬</h1>
    <div id="status"><span class="online-dot" id="dot"></span><span id="statusText">é€£ç·šä¸­...</span></div>

    <div class="card" id="inputCard">
        <h3 id="inputTitle">
            <span>âœï¸ æ–°å¢æˆ°ç¸¾</span>
            <span style="font-size:12px; color:#999; font-weight:normal;">ä»Šå¤©æ‰‹æ°£å¦‚ä½•ï¼Ÿ</span>
        </h3>
        
        <div class="top-inputs">
            <div class="input-group">
                <label>æ—¥æœŸ</label>
                <input type="date" id="dateInput" class="input-style">
            </div>
            <div class="input-group">
                <label>å°‡æ•¸</label>
                <input type="number" id="jiangInput" class="input-style" placeholder="å ´" value="1">
            </div>
            <div class="input-group">
                <label>æ±éŒ¢</label>
                <input type="number" id="dongInput" class="input-style" placeholder="$" value="0">
            </div>
        </div>

        <div id="playersArea"></div>
        <p id="errorMsg" class="error-msg"></p>
        
        <button class="action-btn" id="saveBtn" onclick="saveData()">å„²å­˜ç´€éŒ„</button>
        <button class="cancel-btn" id="cancelBtn" onclick="cancelEdit()">å–æ¶ˆä¿®æ”¹</button>
    </div>

    <div class="card">
        <h3>ğŸ† è‹±é›„æ¦œ (ç¸½æˆ°ç¸¾)</h3>
        <table>
            <thead><tr><th width="15%">æ’å</th><th width="40%">å§“å</th><th width="45%">ç´¯ç©é‡‘é¡</th></tr></thead>
            <tbody id="summaryBody"><tr><td colspan="3">è¼‰å…¥ä¸­...</td></tr></tbody>
        </table>
    </div>

    <div class="card">
        <h3>ğŸ“Š çµ±è¨ˆæ•¸æ“š</h3>
        <table>
            <thead><tr><th>æœˆä»½</th><th>å ´æ¬¡</th><th>æ±éŒ¢</th></tr></thead>
            <tbody id="monthlyStatsBody"><tr><td colspan="3">è¨ˆç®—ä¸­...</td></tr></tbody>
        </table>
        <div id="yearlyStatsFoot" class="yearly-total"></div>
    </div>

    <div class="card">
        <h3>
            ğŸ“œ æ­·å²ç´€éŒ„
            <button onclick="exportCSV()" style="background:transparent; border:1px solid #3498db; color:#3498db; border-radius:20px; padding:4px 10px; font-size:12px; cursor:pointer;">ğŸ“¥ åŒ¯å‡º Excel</button>
        </h3>
        <div id="historyList"></div>
    </div>

    <script>
        // ==========================================
        // â–¼ æ‚¨çš„ Firebase è¨­å®š (å·²è‡ªå‹•å¡«å…¥) â–¼
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBuqMMuRwgysCZrSJagYmZLd2OOciJC1Rc",
            authDomain: "mahjong-app-d6267.firebaseapp.com",
            projectId: "mahjong-app-d6267",
            storageBucket: "mahjong-app-d6267.firebasestorage.app",
            messagingSenderId: "1083238926870",
            appId: "1:1083238926870:web:f1ffe3b5eadf959bcd8337",
            measurementId: "G-H7T8N8YCG1"
        };
        // ==========================================

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const recordsRef = db.ref('records');
        let localRecords = [];
        let currentEditId = null;

        // é€£ç·šç‹€æ…‹
        db.ref('.info/connected').on('value', function(snap) {
            const statusText = document.getElementById('statusText');
            const dot = document.getElementById('dot');
            if (snap.val() === true) {
                statusText.innerText = "å·²é€£ç·šé›²ç«¯"; dot.classList.add('connected');
            } else {
                statusText.innerText = "æ–·ç·šé‡é€£ä¸­..."; dot.classList.remove('connected');
            }
        });

        // ç›£è½è³‡æ–™
        recordsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            localRecords = [];
            if (data) {
                Object.keys(data).forEach(key => {
                    localRecords.push({ id: key, ...data[key] });
                });
                localRecords.sort((a, b) => b.timestamp - a.timestamp);
            }
            render();
        });

        const PREDEFINED_NAMES = ["å®¥è¾°", "å¤ç‘‹", "H", "å­¸å§Š", "ä¸€ä¸­", "ç››å®‰"];
        document.getElementById('dateInput').valueAsDate = new Date();
        initPlayerInputs();

        function initPlayerInputs() {
            const container = document.getElementById('playersArea');
            let html = '';
            let optionsHtml = `<option value="" disabled selected>é¸æ“‡ç©å®¶</option>`;
            PREDEFINED_NAMES.forEach(name => optionsHtml += `<option value="${name}">${name}</option>`);
            optionsHtml += `<option value="Other">è‡ªè¡Œè¼¸å…¥...</option>`;

            for (let i = 1; i <= 4; i++) {
                html += `
                <div class="player-row">
                    <div style="flex:2;">
                        <select class="name-select" onchange="handleNameChange(this)">${optionsHtml}</select>
                        <input type="text" class="custom-name" placeholder="è¼¸å…¥åå­—">
                    </div>
                    <button class="sign-btn btn-plus" onclick="toggleSign(this)">+</button>
                    <input type="number" class="score-input" placeholder="0" inputmode="numeric">
                </div>`;
            }
            container.innerHTML = html;
        }

        function handleNameChange(select) {
            const wrapper = select.parentElement;
            const custom = wrapper.querySelector('.custom-name');
            if (select.value === 'Other') { select.style.display='none'; custom.style.display='block'; custom.focus(); }
            else { custom.style.display='none'; select.style.display='block'; custom.value=''; }
        }

        function toggleSign(btn) {
            if (btn.innerText === '+') { btn.innerText = '-'; btn.className = 'sign-btn btn-minus'; } 
            else { btn.innerText = '+'; btn.className = 'sign-btn btn-plus'; }
        }

        function saveData() {
            const date = document.getElementById('dateInput').value;
            const jiangCount = parseInt(document.getElementById('jiangInput').value) || 0;
            const dongQian = parseInt(document.getElementById('dongInput').value) || 0;
            const rows = document.querySelectorAll('.player-row');
            
            let currentEntry = [];
            let totalScore = 0;
            let namesCheck = new Set();

            for (let row of rows) {
                const select = row.querySelector('.name-select');
                const customInput = row.querySelector('.custom-name');
                const signBtn = row.querySelector('.sign-btn');
                const scoreInput = row.querySelector('.score-input');
                
                let name = select.style.display !== 'none' ? select.value : customInput.value.trim();
                if (!name || name === "Other") { showError("âš ï¸ è«‹è¼¸å…¥ç©å®¶åå­—"); return; }
                if (namesCheck.has(name)) { showError(`âš ï¸ åå­—é‡è¤‡ï¼š${name}`); return; }
                namesCheck.add(name);

                let rawScore = parseInt(scoreInput.value);
                if (isNaN(rawScore)) { showError(`âš ï¸ è«‹è¼¸å…¥ ${name} çš„é‡‘é¡`); return; }
                let finalScore = Math.abs(rawScore) * (signBtn.innerText === '+' ? 1 : -1);

                currentEntry.push({ name: name, score: finalScore });
                totalScore += finalScore;
            }

            if (totalScore !== 0) { showError(`âš ï¸ å¸³ç›®ä¸å¹³ï¼ç›®å‰ç¸½å’Œ ${totalScore}`); return; }

            const recordData = {
                date: date,
                timestamp: Date.now(),
                jiangCount: jiangCount,
                dongQian: dongQian,
                details: currentEntry
            };

            if (currentEditId) {
                recordsRef.child(currentEditId).update(recordData)
                    .then(() => { alert("âœ… ä¿®æ”¹æˆåŠŸï¼"); cancelEdit(); })
                    .catch(err => alert("ä¿®æ”¹å¤±æ•—: " + err.message));
            } else {
                recordsRef.push(recordData)
                    .then(() => { resetForm(); alert("âœ… å„²å­˜æˆåŠŸï¼"); })
                    .catch(err => alert("å„²å­˜å¤±æ•—: " + err.message));
            }
        }

        function editRecord(id) {
            const record = localRecords.find(r => r.id === id);
            if (!record) return;

            document.getElementById('dateInput').value = record.date;
            document.getElementById('jiangInput').value = record.jiangCount || 0;
            document.getElementById('dongInput').value = record.dongQian || 0;

            const rows = document.querySelectorAll('.player-row');
            for (let i = 0; i < 4; i++) {
                if (i < record.details.length) {
                    const p = record.details[i];
                    const row = rows[i];
                    const select = row.querySelector('.name-select');
                    const custom = row.querySelector('.custom-name');
                    const score = row.querySelector('.score-input');
                    const btn = row.querySelector('.sign-btn');

                    if (PREDEFINED_NAMES.includes(p.name)) {
                        select.value = p.name; select.style.display = 'block'; custom.style.display = 'none';
                    } else {
                        select.value = 'Other'; select.style.display = 'none'; custom.style.display = 'block'; custom.value = p.name;
                    }

                    score.value = Math.abs(p.score);
                    if (p.score < 0) { btn.innerText = '-'; btn.className = 'sign-btn btn-minus'; }
                    else { btn.innerText = '+'; btn.className = 'sign-btn btn-plus'; }
                }
            }

            currentEditId = id;
            document.getElementById('inputCard').classList.add('editing-mode');
            document.getElementById('inputTitle').innerHTML = "<span>âœï¸ ä¿®æ”¹æˆ°ç¸¾ä¸­...</span>";
            document.getElementById('saveBtn').innerText = "ç¢ºèªä¿®æ”¹";
            document.getElementById('saveBtn').style.backgroundColor = "#f39c12";
            document.getElementById('cancelBtn').style.display = "block";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            currentEditId = null;
            document.getElementById('inputCard').classList.remove('editing-mode');
            document.getElementById('inputTitle').innerHTML = "<span>âœï¸ æ–°å¢æˆ°ç¸¾</span><span style='font-size:12px; color:#999; font-weight:normal;'>ä»Šå¤©æ‰‹æ°£å¦‚ä½•ï¼Ÿ</span>";
            document.getElementById('saveBtn').innerText = "å„²å­˜ç´€éŒ„";
            document.getElementById('saveBtn').style.backgroundColor = "";
            document.getElementById('cancelBtn').style.display = "none";
            resetForm();
        }

        function resetForm() {
            const rows = document.querySelectorAll('.player-row');
            rows.forEach(row => {
                row.querySelector('.score-input').value = '';
                let btn = row.querySelector('.sign-btn');
                btn.innerText = '+'; btn.className = 'sign-btn btn-plus';
            });
            document.getElementById('dongInput').value = 0;
            document.getElementById('jiangInput').value = 1;
            showError("");
        }

        function deleteRecord(id) {
            if(!confirm("ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ")) return;
            recordsRef.child(id).remove();
            if (currentEditId === id) cancelEdit();
        }

        function render() {
            // æ¸²æŸ“æ­·å² (æ”¹ç‚º List æ¨£å¼)
            const listDiv = document.getElementById('historyList');
            listDiv.innerHTML = '';
            if (localRecords.length === 0) { listDiv.innerHTML = '<p style="text-align:center; color:#999; padding:20px;">å°šç„¡ç´€éŒ„</p>'; }

            localRecords.forEach(rec => {
                let detailsHtml = rec.details.map(p => {
                    let colorClass = p.score > 0 ? 'win-text' : (p.score < 0 ? 'lose-text' : 'zero-text');
                    let sign = p.score > 0 ? '+' : '';
                    return `<div><span>${p.name}</span> <span class="${colorClass}">${sign}${p.score}</span></div>`;
                }).join('');

                let item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div style="flex:1;">
                        <div class="history-date">${rec.date}</div>
                        <div style="margin-bottom:5px;">
                            ${rec.jiangCount ? `<span class="history-info">ğŸ€„ ${rec.jiangCount}å°‡</span>` : ''}
                            ${rec.dongQian ? `<span class="history-info">ğŸ’° æ±${rec.dongQian}</span>` : ''}
                        </div>
                        <div class="history-scores">${detailsHtml}</div>
                    </div>
                    <div class="history-actions">
                        <button class="edit-btn" onclick="editRecord('${rec.id}')">âœ</button>
                        <button class="delete-btn" onclick="deleteRecord('${rec.id}')">âœ•</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });

            // æ¸²æŸ“ç¸½æ¦œ
            let stats = {};
            localRecords.forEach(rec => {
                rec.details.forEach(p => {
                    if (!stats[p.name]) stats[p.name] = 0;
                    stats[p.name] += p.score;
                });
            });
            const summaryBody = document.getElementById('summaryBody');
            summaryBody.innerHTML = '';
            
            if (Object.keys(stats).length === 0) { summaryBody.innerHTML = '<tr><td colspan="3" style="color:#999;">æš«ç„¡è³‡æ–™</td></tr>'; }
            else {
                Object.entries(stats).sort(([,a], [,b]) => b - a).forEach(([name, score], index) => {
                    let colorClass = score > 0 ? 'win-text' : (score < 0 ? 'lose-text' : 'zero-text');
                    let sign = score > 0 ? '+' : '';
                    let rankClass = index < 3 ? `rank-${index+1}` : 'rank-other';
                    let rankText = index + 1;
                    if(index === 0) rankText = 'ğŸ¥‡';
                    
                    summaryBody.innerHTML += `<tr>
                        <td><span class="rank-badge ${rankClass}">${rankText}</span></td>
                        <td style="font-weight:500;">${name}</td>
                        <td class="${colorClass}" style="font-size:16px;">${sign}${score}</td>
                    </tr>`;
                });
            }

            // æœˆåº¦èˆ‡å¹´åº¦çµ±è¨ˆ
            let monthlyData = {}; 
            let yearlyJiang = {}; 

            localRecords.forEach(rec => {
                let dateObj = new Date(rec.date);
                let year = dateObj.getFullYear();
                let month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                let key = `${year}-${month}`;

                if (!monthlyData[key]) monthlyData[key] = { jiang: 0, dong: 0 };
                if (!yearlyJiang[year]) yearlyJiang[year] = 0;

                let j = parseInt(rec.jiangCount) || 0;
                let d = parseInt(rec.dongQian) || 0;

                monthlyData[key].jiang += j;
                monthlyData[key].dong += d;
                yearlyJiang[year] += j;
            });

            const statsBody = document.getElementById('monthlyStatsBody');
            const yearFoot = document.getElementById('yearlyStatsFoot');
            statsBody.innerHTML = '';
            yearFoot.innerHTML = '';

            let sortedKeys = Object.keys(monthlyData).sort().reverse();
            if (sortedKeys.length === 0) { statsBody.innerHTML = '<tr><td colspan="3">æš«ç„¡è³‡æ–™</td></tr>'; }
            else {
                sortedKeys.forEach(key => {
                    let d = monthlyData[key];
                    statsBody.innerHTML += `<tr><td>${key}</td><td>${d.jiang} å°‡</td><td>$${d.dong}</td></tr>`;
                });
            }

            let sortedYears = Object.keys(yearlyJiang).sort().reverse();
            if(sortedYears.length > 0) {
                yearFoot.innerHTML = `ğŸ“… ${sortedYears[0]} å¹´åº¦ç¸½çµï¼šå…± <span style="color:#e67e22; font-size:18px;">${yearlyJiang[sortedYears[0]]}</span> å°‡`;
            }
        }

        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.innerText = msg; el.style.display = msg ? 'block' : 'none';
        }

        function exportCSV() {
            let csv = "\uFEFFæ—¥æœŸ,å°‡æ•¸,æ±éŒ¢,ç©å®¶,é‡‘é¡\n";
            localRecords.forEach(rec => {
                rec.details.forEach(p => {
                    csv += `${rec.date},${rec.jiangCount || 0},${rec.dongQian || 0},${p.name},${p.score}\n`;
                });
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `éº»å°‡æˆ°ç¸¾_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }
    </script>
</body>
</html>
